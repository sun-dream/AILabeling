customElements.get("shoppable-video")||customElements.define("shoppable-video",class extends HTMLElement{constructor(){super()}bindMethods(){this.togglePlayPause=this.togglePlayPause.bind(this),this.toggleVideoIcon=this.toggleVideoIcon.bind(this),this.playVideo=this.playVideo.bind(this),this.updateScrollPosition=this.updateScrollPosition.bind(this),this.throttleUpdateScroll=this.throttle(this.updateScrollPosition,250),this.checkDominantProductElement=this.checkDominantProductElement.bind(this),this.handleScrollAndUpdateVideoPosition=this.handleScrollAndUpdateVideoPosition.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this)}setupElements(){this.productsInfo=JSON.parse(this.dataset.products),this.productsInfoArr=Object.entries(this.productsInfo),this.video=this.querySelector("video"),this.productsContainer=this.querySelector(".shoppable-video__products"),this.controlButton=this.querySelector(".shoppable-video__control-button"),this.products=this.productsContainer.querySelectorAll(".shoppable-video__product"),this.emptyProduct=this.productsContainer.querySelector(".shoppable-video__empty-product"),this.playButtons=this.productsContainer.querySelectorAll(".shoppable-video__rewind-button"),this.lastScrolledToProductIndex=null,this.playButtonsListeners=[],this.isTouching=!1,this.startX=0,this.startY=0,this.scrollLeftStart=0,this.scrollTopStart=0,this.lastScrollLeft=0,this.dominantProductIndex=0,this.scrollTimeout=null,this.touchEnded=!1,this.calculateEmptyProductWidth()}addEventListeners(){this.controlButton.addEventListener("click",this.togglePlayPause),this.video?.addEventListener("timeupdate",this.throttleUpdateScroll),this.video?.addEventListener("play",this.toggleVideoIcon),this.video?.addEventListener("pause",this.toggleVideoIcon),this.productsContainer.addEventListener("touchstart",this.handleTouchStart),this.productsContainer.addEventListener("scroll",this.handleScrollAndUpdateVideoPosition),this.productsContainer.addEventListener("touchmove",this.handleScrollAndUpdateVideoPosition),this.productsContainer.addEventListener("touchend",this.handleTouchEnd),this.playButtons.forEach((btn,index)=>{const boundClickRewindButton=this.clickRewindButton.bind(this,btn);btn.addEventListener("click",boundClickRewindButton),this.playButtonsListeners.push({btn,boundClickRewindButton})})}handleTouchStart(e){this.video?.pause(),this.isTouching=!0,this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY,this.scrollLeftStart=this.productsContainer.scrollLeft,this.scrollTopStart=this.productsContainer.scrollTop}handleTouchEnd(){this.touchEnded=!0}handleScrollAndUpdateVideoPosition(){this.scrollTimeout&&clearTimeout(this.scrollTimeout);const currentScrollLeft=this.productsContainer.scrollLeft,scrolledRight=currentScrollLeft>this.lastScrollLeft,scrolledLeft=currentScrollLeft<this.lastScrollLeft;this.lastScrollLeft=currentScrollLeft,this.checkDominantProductElement(scrolledRight,scrolledLeft),this.isTouching&&(this.scrollTimeout=setTimeout(()=>{const startSecond=this.productsInfoArr[this.dominantProductIndex][1];this.lastScrolledToProductIndex=this.dominantProductIndex-1,this.video&&(this.video.currentTime=startSecond,this.video.play())},250))}checkDominantProductElement(){let dominantProductIndex=-1,maxVisibleWidth=-1;this.products.forEach((product,index)=>{const{left,right}=product.getBoundingClientRect(),containerRect=this.productsContainer.getBoundingClientRect(),visibleWidth=Math.min(containerRect.right,right)-Math.max(containerRect.left,left);visibleWidth>maxVisibleWidth&&(maxVisibleWidth=visibleWidth,dominantProductIndex=index)}),maxVisibleWidth/this.productsContainer.offsetWidth>.2&&(this.dominantProductIndex=dominantProductIndex)}calculateEmptyProductWidth(){const firstProductWidth=this.products[1].offsetWidth;this.gap=parseFloat(window.getComputedStyle(this.productsContainer).getPropertyValue("gap")),this.emptyProduct.style.width=`calc(100% - ${firstProductWidth}px - ${this.gap}px)`}setContainerMargin(){let maxHeight=0,elementWithMaxHeight=null;this.products.forEach(element=>{const elementHeight=element.offsetHeight;elementHeight>maxHeight&&(maxHeight=elementHeight,elementWithMaxHeight=element)});const marginValue=window.innerWidth>900?46:34;this.productsContainer.style.marginTop=`-${maxHeight+marginValue}px`}toggleVideoIcon(){const isPlaying=!this.video.paused;this.controlButton.classList.toggle("shoppable-video__control-button--play",isPlaying),this.controlButton.classList.toggle("shoppable-video__control-button--pause",!isPlaying)}removeEventListeners(){this.controlButton.removeEventListener("click",this.togglePlayPause),this.video?.removeEventListener("click",this.togglePlayPause),this.video?.removeEventListener("timeupdate",this.throttleUpdateScroll),this.video?.removeEventListener("play",this.toggleVideoIcon),this.video?.removeEventListener("pause",this.toggleVideoIcon),this.productsContainer.removeEventListener("touchstart",this.handleTouchStart),this.productsContainer.removeEventListener("scroll",this.handleScrollAndUpdateVideoPosition),this.productsContainer.removeEventListener("touchend",this.handleTouchEnd),this.playButtonsListeners.forEach(({btn,boundClickPlayButton})=>{btn.removeEventListener("click",boundClickPlayButton)})}clickRewindButton(btn){const productIndex=btn.dataset.productIndex,startSecond=this.productsInfo[productIndex];this.video.currentTime=startSecond,this.playVideo(),this.animateScrollToNextProduct(productIndex)}animateScrollToNextProduct(productIndex){const productWidth=this.products[productIndex]?.offsetWidth,nextScrollPosition=(Number(this.productsInfoArr[productIndex][0])+1)*(productWidth+this.gap),maxScrollLeft=this.productsContainer.scrollWidth-this.productsContainer.clientWidth,clampedNextScrollPosition=Math.min(nextScrollPosition,maxScrollLeft),startPosition=this.productsContainer.scrollLeft;this.animateScroll(startPosition,clampedNextScrollPosition,250),this.lastScrolledToProductIndex=productIndex}togglePlayPause(e){e.preventDefault();const videoElement=this.video;videoElement&&(videoElement.paused||videoElement.ended?videoElement.play():videoElement.pause())}playVideo(){const videoElement=this.video;videoElement&&(videoElement.paused||videoElement.ended)&&videoElement.play()}updateScrollPosition(){const currentTime=this.video.currentTime,isMobile=window.innerWidth<=400;if(this.isTouching=!1,currentTime<1&&currentTime>0&&this.lastScrolledToProductIndex!==0){this.lastScrolledToProductIndex=0,this.productsContainer.scrollTo({left:0,behavior:"smooth"});return}for(let i=this.lastScrolledToProductIndex||0;i<this.productsInfoArr.length;i++){const itemTime=Number(this.productsInfoArr[i][1]),shouldScrollMove=currentTime>itemTime&&currentTime<itemTime+1;let nextScrollPosition;if(isMobile?nextScrollPosition=this.products[i].offsetLeft-10:nextScrollPosition=this.products[i].offsetLeft+this.products[i].offsetWidth-this.productsContainer.offsetWidth+20,nextScrollPosition=Math.max(nextScrollPosition,0),shouldScrollMove&&Math.abs(this.productsContainer.scrollLeft-nextScrollPosition)>1){this.lastScrolledToProductIndex=i;const clampedNextScrollPosition=Math.min(nextScrollPosition,this.productsContainer.scrollWidth-this.productsContainer.clientWidth),startPosition=this.productsContainer.scrollLeft;this.animateScroll(startPosition,clampedNextScrollPosition,250);break}}}throttle(func,limit){let inThrottle;return function(){const args=arguments,context=this;inThrottle||(func.apply(context,args),inThrottle=!0,setTimeout(()=>inThrottle=!1,limit))}}animateScroll(startPosition,endPosition,duration){const start=performance.now(),animate=time=>{const timeElapsed=time-start,progress=Math.min(timeElapsed/duration,1),currentPosition=startPosition+(endPosition-startPosition)*this.easeOutSine(progress);this.productsContainer.scrollLeft=currentPosition,timeElapsed<duration?requestAnimationFrame(animate):this.productsContainer.scrollLeft=endPosition};requestAnimationFrame(animate)}easeOutSine(t){return Math.sin(t*Math.PI/2)}connectedCallback(){this.setupElements(),this.bindMethods(),this.addEventListeners()}disconnectedCallback(){this.removeEventListeners()}});
//# sourceMappingURL=/cdn/shop/t/41/assets/shoppable-video.js.map?v=79610875179123462481754657649
